<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thai Text-to-Speech</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="min-vh-100 d-flex flex-column align-items-center justify-content-center p-4">
  <h1 class="fs-2 fw-bold mb-4">Thai Text-to-Speech</h1>
  <div class="mb-2">
  </div>
  <textarea id="text-input" rows="4" class="form-control w-100 max-w-md mb-4" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
  </textarea>
  <div id="highlighted-text" class="w-100 max-w-md mb-4 text-center fw-medium fs-5 text-danger" style="height: 1rem;">
  </div>

  <div class="d-flex gap-2 mb-4 flex-wrap justify-content-center">
    <button onclick="speakText()" class="btn btn-dark">
      üîä ‡∏û‡∏π‡∏î‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    </button>
    <button onclick="pauseOrResume()" class="btn btn-warning">
      ‚è∏ ‡∏´‡∏¢‡∏∏‡∏î/‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠
    </button>
    <button onclick="stopSpeech()" class="btn btn-secondary">
      ‚èπ ‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏π‡∏î
    </button>
    <button onclick="copyText()" class="btn btn-primary">
      üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    </button>
    <button onclick="clearText()" class="btn btn-danger">
      ‚ùå ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    </button>
  </div>

  <div class="mb-4 w-100 max-w-md">
    <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤:</label>
    <select id="languageSelect" class="form-select mb-2" title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤"></select>

    <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á:</label>
    <select id="voiceSelect" class="form-select" title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á"></select>
  </div>

  <div class="mb-4 w-100 max-w-md">
    <label class="form-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß:</label>
    <div class="d-flex justify-content-between align-items-center">
      <span class="me-2">‡∏ä‡πâ‡∏≤</span>
      <span class="ms-2">‡πÄ‡∏£‡πá‡∏ß</span>
    </div>
    <div class="d-flex align-items-center">
      <input type="range" id="rate" class="form-range flex-grow-1" min="0.5" max="2" step="0.1" value="1"
        title="‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß">
    </div>
    <div class="text-center mt-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö: <span id="rateValue">1</span></div>

    <label class="form-label mt-3">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡πà‡∏≥/‡∏™‡∏π‡∏á</label>
    <div class="d-flex justify-content-between align-items-center">
      <span class="me-2">‡∏ï‡πà‡∏≥</span>
      <span class="ms-2">‡∏™‡∏π‡∏á</span>
    </div>
    <div class="d-flex align-items-center">
      <input type="range" id="pitch" class="form-range flex-grow-1" min="0" max="2" step="0.1" value="1"
        title="‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á">
    </div>
    <div class="text-center mt-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö: <span id="pitchValue">1</span></div>
  </div>

  <p class="text-muted mt-2 small">
    *‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ (Web Speech API ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)
  </p>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const textInput = document.getElementById('text-input');
    const voiceSelect = document.getElementById('voiceSelect');
    const languageSelect = document.getElementById('languageSelect');
    const rateInput = document.getElementById('rate');
    const pitchInput = document.getElementById('pitch');
    const themeToggle = document.getElementById('themeToggle');
    const highlightDiv = document.getElementById('highlighted-text');

    let voices = [];
    let utter;
    let isPaused = false;

    textInput.value = '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á';

    // Default Thai text
    if (!localStorage.getItem('ttsVisited')) {
      textInput.value = '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
      localStorage.setItem('ttsVisited', 'true');
    }

    function populateLanguages() {
      const langs = [...new Set(window.speechSynthesis.getVoices().map(v => v.lang))];
      languageSelect.innerHTML = '';
      langs.sort().forEach(lang => {
        const option = document.createElement('option');
        option.value = lang;
        option.textContent = lang;
        languageSelect.appendChild(option);
      });

      const defaultLang = 'th-TH';
      if ([...languageSelect.options].some(opt => opt.value === defaultLang)) {
        languageSelect.value = defaultLang;
        populateVoices();
      }
    }

    function populateVoices() {
      voices = window.speechSynthesis.getVoices();
      const selectedLang = languageSelect.value;
      voiceSelect.innerHTML = '';
      voices
        .filter(voice => voice.lang === selectedLang)
        .forEach((voice, i) => {
          const option = document.createElement('option');
          option.value = voice.name;
          option.textContent = `${voice.name} (${voice.lang})`;
          voiceSelect.appendChild(option);
        });
    }

    function speakText() {
      stopSpeech();
      const text = textInput.value;
      const selectedVoice = voices.find(v => v.name === voiceSelect.value);
      utter = new SpeechSynthesisUtterance(text);
      if (selectedVoice) utter.voice = selectedVoice;
      utter.lang = selectedVoice?.lang || 'th-TH';
      utter.rate = parseFloat(rateInput.value);
      utter.pitch = parseFloat(pitchInput.value);

      utter.onboundary = (event) => {
        if (event.name === 'word') {
          const word = text.substring(event.charIndex, event.charIndex + event.charLength);
          highlightDiv.textContent = word;
        }
      };

      utter.onend = () => {
        highlightDiv.textContent = '';
      };

      window.speechSynthesis.speak(utter);
    }

    function pauseOrResume() {
      if (window.speechSynthesis.speaking) {
        if (isPaused) {
          window.speechSynthesis.resume();
        } else {
          window.speechSynthesis.pause();
        }
        isPaused = !isPaused;
      }
    }

    function stopSpeech() {
      if (window.speechSynthesis.speaking || isPaused) {
        window.speechSynthesis.cancel();
        highlightDiv.textContent = '';
        isPaused = false;
      }
    }

    function copyText() {
      navigator.clipboard.writeText(textInput.value);
      alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
    }

    function clearText() {
      textInput.value = '';
    }

    window.speechSynthesis.onvoiceschanged = () => {
      populateLanguages();
    };

    languageSelect.addEventListener('change', populateVoices);

    // Update displayed values for rate and pitch
    rateInput.addEventListener('input', () => {
      document.getElementById('rateValue').textContent = rateInput.value;
    });

    pitchInput.addEventListener('input', () => {
      document.getElementById('pitchValue').textContent = pitchInput.value;
    });
  </script>
</body>

</html>